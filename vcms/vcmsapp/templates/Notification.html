{% extends 'Base.html' %}

{% block title %}Notifications{% endblock %}

{% block content %}
<div style="padding: 0%;">
    <div class="row mb-3" style="margin-left: auto;">
        <div class="col-6">
            <h1 style="font-weight: bold;">
                Notifications
            </h1>
        </div>
        <div class="col-3"></div>
        <div class="col-3">
            {% include 'components/anchor-button.html' with url='#' text="Clear Notifications" id='clearBtn' modal_toggle=True modal_id='clearModal' %}
        </div>
    </div> 
    <div class="row" style="height: fit-content; width: 100%; margin-left: auto;">
        <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-inner">
                    {% for page in pages %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            {% for row in page|slice:":3" %}
                                <div class="row">
                                    {% for data in row %}
                                        <div class="col-md-4">
                                            {% url 'vcmsapp:notification-redirect' notification_id=data.id as url %}
                                            {% if data.is_read %}
                                                {% include 'components/card.html' with header=data.title label=data.content url=url color='red' %}
                                            {% else %}
                                                {% include 'components/card.html' with header=data.title label=data.content url=url color='green' %}
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endfor %}
                        </div>
                    {% empty %}
                        <div class="col-md-12" style="text-align: center;">
                            <p>No notifications. Don't worry, you are not having a poor internet connection :></p>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="clearModal" tabindex="-1" aria-labelledby="clearModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="clearModalLabel">Clear Notification</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h4>Are you sure to clear all notifications?</h4>
            </div>
            <div class="modal-footer">
                <div class="row" style="width: 100%;">
                    <div style="display: flex; justify-content: center;">
                        <div class="col-5 mx-2">
                            {% include 'components/anchor-button.html' with url='#' text='Back' modal_dismiss=True %}
                        </div>
                        <div class="col-5 mx-2">
                            <form action="{% if customer %}{% url 'vcmsapp:clear-notification-customer' customer_id=customer.id as url %}{% elif staff %}{% url 'vcmsapp:clear-notification-staff' staff_id=staff.id as url %}{% endif %}" method="post" id="clearForm">
                                {% csrf_token %}
                                {% include 'components/input.html' with type='hidden' id='customer_id' name='customer_id' value=customer.id %}
                                {% include 'components/anchor-button.html' with url='#' text='Clear' id='clearNotificationBtn' %}
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var clearBtn = document.getElementById('clearNotificationBtn');
    var form = document.getElementById('clearForm');

    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            if (form.reportValidity()) {
                form.submit();
            }
        });
    }
</script>
{% endblock %}